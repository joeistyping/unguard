# JWT Forgery

The `user-auth-service` of Unguard uses a vulnerable version of the library
[jwt-simple](https://www.npmjs.com/package/jwt-simple) `<0.5.3`
that allows you to forge a JWT token to authenticate as another user.

- Improperly Implemented Security Check for Standard [(CWE-358)](https://cwe.mitre.org/data/definitions/358.html)
- Signature Verification Bypass [(SNYK-JS-JWTSIMPLE-174523)](https://security.snyk.io/vuln/SNYK-JS-JWTSIMPLE-174523)

## Preconditions And Requirements

For this exploit to work you need:
* [unguard](../../../docs/DEV-GUIDE.md) deployed and running, specifically, the *user-auth-service*
* [unguard-exploit-toolkit](../../INSTALL.md) set up

Further details can be found in the [user-auth-service](../../../src/user-auth-service/README.md) project.

## Exploitation

To forge a JWT token provide the desired usertag (a combination of *username:userid*) to the CLI after logging in
with another user first.

**Attention:** The username and user ID have to match, otherwise the forged token will not have the right permissions.

```shell
$ ug-exploit login bob
$ ug-exploit forge-token admin:1
```

Now you can either use *ug-exploit* with the forged user (logged in automatically) or use the forged token, which is
printed to the command-line manually.

You can now use this token and add it to the *cookie* named "jwt" as a value (for example in *Chrome* -> *Developer
Tools* -> *Application* -> *Cookies*).
